---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# datacommons

<!-- badges: start -->
![R CMD Check](https://github.com/tidy-intelligence/r-datacommons/actions/workflows/R-CMD-check.yaml/badge.svg)
![Lint](https://github.com/tidy-intelligence/r-datacommons/actions/workflows/lint.yaml/badge.svg)
[![Codecov test coverage](https://codecov.io/gh/tidy-intelligence/r-datacommons/graph/badge.svg)](https://app.codecov.io/gh/tidy-intelligence/r-datacommons)
<!-- badges: end -->

Access the Google [Data Commons API V2](https://docs.datacommons.org/api/rest/v2/). Data Commons provides programmatic access to statistical and demographic data from dozens of sources organized in a knowldege graph. 

## Installation

You can install `datacommons` from CRAN via:

```{r eval=FALSE}
install.packages("datacommons")
``` 

You can install the development version of `datacommons` from GitHub with:

```{r eval=FALSE}
# install.packages("pak")
pak::pak("tidy-intelligence/r-datacommons")
```

## Usage

Load the package:

```{r}
library(datacommons)
```

Get a free API key for Data Commons [here](https://docs.datacommons.org/api/#obtain-an-api-key). Set the Data Commons API key as the `DATACOMMONS_API_KEY` environment variable using the helper function and restart your R session to load the key:

```{r, eval=FALSE}
dc_set_api_key("YOUR_API_KEY")
```

If you want to use a [custom Data Commons instance](https://docs.datacommons.org/api/rest/v2/#base-url-for-custom-instances), then you can also set the `DATACOMMONS_BASE_URL` environment varibale on the project or global level:

```{r, eval=FALSE}
dc_set_base_url("YOUR_BASE_URL")
```

Get a data frame with US population data from [World Development Indicators](https://datacommons.org/browser/dc/base/WorldDevelopmentIndicators):

```{r}
country_level <- dc_get_observations(
  date = "all",
  variable_dcids = "Count_Person",
  entity_dcids = "country/USA",
  return_type = "data.frame",
  filter_facet_id = 3981252704
)
head(country_level, 5)
```

If you want to get different population numbers from the [US Census](https://datacommons.org/browser/dc/base/USCensusPEP_Annual_Population) on the state level:

```{r}
state_level <- dc_get_observations(
  variable_dcids = "Count_Person",
  date = 2021,
  parent_entity = "country/USA",
  entity_type = "State",
  return_type = "data.frame",
  filter_facet_id = 2176550201
)
head(state_level, 5)
```

## Contributing

Contributions to `oecdoda` are welcome! If you'd like to contribute, please follow these steps:

1. **Create an issue**: Before making changes, create an issue describing the bug or feature you're addressing.
2. **Fork the repository**: After receiving supportive feedback from the package authors, fork the repository to your GitHub account.
3. **Create a branch**: Create a branch for your changes with a descriptive name.
4. **Make your changes**: Implement your bug fix or feature.
5. **Test your changes**: Run tests to ensure your changes don't break existing functionality.
6. **Submit a pull request**: Push your changes to your fork and submit a pull request to the main repository.